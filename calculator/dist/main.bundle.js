(()=>{"use strict";class e{constructor(){this.events={}}on(e,s){this.events[e]||(this.events[e]=[]),this.events[e].push(s)}emit(e,...s){const t=this.events[e];if(!t)throw new Error("Define listener for current emit event");t.forEach((e=>e(...s)))}}class s extends e{constructor(e){super(),this.elements=e,e.numberButtons.addEventListener("click",(e=>{this.emit("numberButtonClicked",e.target.innerHTML)})),e.modifyButtons.addEventListener("click",(e=>{this.emit("modifyButtonClicked",e.target.innerHTML)})),e.computeButtons.addEventListener("click",(e=>{this.emit("computeButtonClicked",e.target.innerHTML)}))}renderMainDisplay(e){const{mainDisplay:s}=this.elements;return s.value=e.join(""),s.value}renderMemoryDisplay(e){const{memoryDisplay:s}=this.elements;return s.value=e.join(" "),s.value}}class t{constructor(e,s){this.model=e,this.view=s,s.on("numberButtonClicked",(e=>this.add(e))),s.on("modifyButtonClicked",(e=>this.chooseModificator(e))),s.on("computeButtonClicked",(e=>this.compute(e))),e.on("number added",(e=>s.renderMainDisplay(e))),e.on("number changed",(e=>s.renderMainDisplay(e))),e.on("memory changed",(e=>s.renderMemoryDisplay(e)))}add(e){this.model.add(e)}chooseModificator(e){switch(e){case"C":this.model.reset();break;case"-X":this.model.minus();break;case".":this.model.decimal();break;case"âˆš":this.model.sqrt();break;default:throw new Error("Unexpected button value")}}compute(e){this.model.compute(e)}run(){this.model.reset()}}class i extends e{constructor(){super(),this.emptyMainDisplay="0",this.numbers=[],this.isNumberSaved=!1,this.memoryPendingOperation="",this.savedNumber=0,this.savedOperations=[]}clear(){this.numbers=[],this.isNumberSaved=!1}refresh(){this.emit("number changed",this.numbers),this.emit("memory changed",this.savedOperations)}add(e){this.isNumberSaved&&this.clear(),"0"===this.numbers.toString()&&"0"===e||("0"===this.numbers.toString()?this.numbers[0]=e:this.numbers.push(e),this.emit("number added",this.numbers))}reset(){this.savedNumber=0,this.clear(),this.numbers.push(this.emptyMainDisplay),this.savedOperations=[],this.refresh()}minus(){"-"!==this.numbers[0]?this.numbers.unshift("-"):this.numbers.shift(),this.refresh()}decimal(){this.isNumberSaved&&this.clear(),this.numbers.includes(".")||this.numbers.push("."),this.refresh()}sqrt(){const e=Number(this.numbers.join("")),s=Math.sqrt(e);this.memoryPendingOperation="",s>=0?(this.savedNumber=s,this.numbers=s.toString().split("")):this.numbers=["current number < 0"],this.refresh()}compute(e){const s=Number(this.numbers.join(""));if(this.numbers=[],this.isNumberSaved&&"="!==this.memoryPendingOperation)this.numbers=this.savedNumber.toString().split(""),this.memoryPendingOperation=e,this.save(e);else{switch(this.isNumberSaved=!0,this.memoryPendingOperation){case"+":this.savedNumber=parseFloat((this.savedNumber+s).toFixed(10));break;case"-":this.savedNumber=parseFloat((this.savedNumber-s).toFixed(10));break;case"*":this.savedNumber=parseFloat((this.savedNumber*s).toFixed(10));break;case"/":this.savedNumber=parseFloat((this.savedNumber/s).toFixed(10));break;case"^":this.savedNumber=parseFloat((this.savedNumber**s).toFixed(10));break;case"=":this.savedNumber=s;break;default:this.savedNumber=s}this.numbers=this.savedNumber.toString().split(""),this.refresh(),this.memoryPendingOperation=e,this.save(e,s)}}save(e,s){s?"="!==e?this.savedOperations.splice(this.savedOperations.length,0,s,e):this.savedOperations=[]:this.savedOperations.splice(this.savedOperations.length-1,1,e),this.refresh()}}window.addEventListener("load",(()=>{const e=new i,r=new s({numberButtons:document.querySelector(".number-buttons"),modifyButtons:document.querySelector(".modify-buttons"),computeButtons:document.querySelector(".compute-buttons"),mainDisplay:document.getElementById("main-display"),memoryDisplay:document.getElementById("memory-display")});new t(e,r).run()}))})();